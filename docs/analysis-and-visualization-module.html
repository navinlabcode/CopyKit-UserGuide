<!DOCTYPE html>
<html lang="" xml:lang="">
<head>

  <meta charset="utf-8" />
  <meta http-equiv="X-UA-Compatible" content="IE=edge" />
  <title>7 Analysis and Visualization module | CopyKit User Guide</title>
  <meta name="description" content="This is a user guide for the package CopyKit: A toolkit for single-cell CNA analysis." />
  <meta name="generator" content="bookdown 0.26 and GitBook 2.6.7" />

  <meta property="og:title" content="7 Analysis and Visualization module | CopyKit User Guide" />
  <meta property="og:type" content="book" />
  
  <meta property="og:description" content="This is a user guide for the package CopyKit: A toolkit for single-cell CNA analysis." />
  

  <meta name="twitter:card" content="summary" />
  <meta name="twitter:title" content="7 Analysis and Visualization module | CopyKit User Guide" />
  
  <meta name="twitter:description" content="This is a user guide for the package CopyKit: A toolkit for single-cell CNA analysis." />
  

<meta name="author" content="Darlan Conterno Minussi" />



  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <meta name="apple-mobile-web-app-capable" content="yes" />
  <meta name="apple-mobile-web-app-status-bar-style" content="black" />
  
  
<link rel="prev" href="knn-smoothing.html"/>
<link rel="next" href="merging-copykit-objects.html"/>
<script src="libs/jquery-3.6.0/jquery-3.6.0.min.js"></script>
<script src="https://cdn.jsdelivr.net/npm/fuse.js@6.4.6/dist/fuse.min.js"></script>
<link href="libs/gitbook-2.6.7/css/style.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-table.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-bookdown.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-highlight.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-search.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-fontsettings.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-clipboard.css" rel="stylesheet" />








<link href="libs/anchor-sections-1.1.0/anchor-sections.css" rel="stylesheet" />
<link href="libs/anchor-sections-1.1.0/anchor-sections-hash.css" rel="stylesheet" />
<script src="libs/anchor-sections-1.1.0/anchor-sections.js"></script>


<style type="text/css">
pre > code.sourceCode { white-space: pre; position: relative; }
pre > code.sourceCode > span { display: inline-block; line-height: 1.25; }
pre > code.sourceCode > span:empty { height: 1.2em; }
.sourceCode { overflow: visible; }
code.sourceCode > span { color: inherit; text-decoration: inherit; }
pre.sourceCode { margin: 0; }
@media screen {
div.sourceCode { overflow: auto; }
}
@media print {
pre > code.sourceCode { white-space: pre-wrap; }
pre > code.sourceCode > span { text-indent: -5em; padding-left: 5em; }
}
pre.numberSource code
  { counter-reset: source-line 0; }
pre.numberSource code > span
  { position: relative; left: -4em; counter-increment: source-line; }
pre.numberSource code > span > a:first-child::before
  { content: counter(source-line);
    position: relative; left: -1em; text-align: right; vertical-align: baseline;
    border: none; display: inline-block;
    -webkit-touch-callout: none; -webkit-user-select: none;
    -khtml-user-select: none; -moz-user-select: none;
    -ms-user-select: none; user-select: none;
    padding: 0 4px; width: 4em;
    color: #aaaaaa;
  }
pre.numberSource { margin-left: 3em; border-left: 1px solid #aaaaaa;  padding-left: 4px; }
div.sourceCode
  {   }
@media screen {
pre > code.sourceCode > span > a:first-child::before { text-decoration: underline; }
}
code span.al { color: #ff0000; font-weight: bold; } /* Alert */
code span.an { color: #60a0b0; font-weight: bold; font-style: italic; } /* Annotation */
code span.at { color: #7d9029; } /* Attribute */
code span.bn { color: #40a070; } /* BaseN */
code span.bu { } /* BuiltIn */
code span.cf { color: #007020; font-weight: bold; } /* ControlFlow */
code span.ch { color: #4070a0; } /* Char */
code span.cn { color: #880000; } /* Constant */
code span.co { color: #60a0b0; font-style: italic; } /* Comment */
code span.cv { color: #60a0b0; font-weight: bold; font-style: italic; } /* CommentVar */
code span.do { color: #ba2121; font-style: italic; } /* Documentation */
code span.dt { color: #902000; } /* DataType */
code span.dv { color: #40a070; } /* DecVal */
code span.er { color: #ff0000; font-weight: bold; } /* Error */
code span.ex { } /* Extension */
code span.fl { color: #40a070; } /* Float */
code span.fu { color: #06287e; } /* Function */
code span.im { } /* Import */
code span.in { color: #60a0b0; font-weight: bold; font-style: italic; } /* Information */
code span.kw { color: #007020; font-weight: bold; } /* Keyword */
code span.op { color: #666666; } /* Operator */
code span.ot { color: #007020; } /* Other */
code span.pp { color: #bc7a00; } /* Preprocessor */
code span.sc { color: #4070a0; } /* SpecialChar */
code span.ss { color: #bb6688; } /* SpecialString */
code span.st { color: #4070a0; } /* String */
code span.va { color: #19177c; } /* Variable */
code span.vs { color: #4070a0; } /* VerbatimString */
code span.wa { color: #60a0b0; font-weight: bold; font-style: italic; } /* Warning */
</style>


<link rel="stylesheet" href="style.css" type="text/css" />
</head>

<body>



  <div class="book without-animation with-summary font-size-2 font-family-1" data-basepath=".">

    <div class="book-summary">
      <nav role="navigation">

<ul class="summary">
<li class="toc-logo"><a href="./"><img src="images/copykit_hexsticker_v2.png"></a></li>

<li class="divider"></li>
<li class="chapter" data-level="1" data-path="index.html"><a href="index.html"><i class="fa fa-check"></i><b>1</b> Introduction</a></li>
<li class="chapter" data-level="2" data-path="parallelization.html"><a href="parallelization.html"><i class="fa fa-check"></i><b>2</b> Parallelization</a></li>
<li class="chapter" data-level="3" data-path="quick-start.html"><a href="quick-start.html"><i class="fa fa-check"></i><b>3</b> Quick-Start</a></li>
<li class="chapter" data-level="4" data-path="pre-processing.html"><a href="pre-processing.html"><i class="fa fa-check"></i><b>4</b> Pre-processing</a>
<ul>
<li class="chapter" data-level="4.1" data-path="pre-processing.html"><a href="pre-processing.html#from-single-cell-bam-files"><i class="fa fa-check"></i><b>4.1</b> From Single Cell BAM files</a>
<ul>
<li class="chapter" data-level="4.1.1" data-path="pre-processing.html"><a href="pre-processing.html#runvarbin"><i class="fa fa-check"></i><b>4.1.1</b> runVarbin()</a></li>
</ul></li>
<li class="chapter" data-level="4.2" data-path="pre-processing.html"><a href="pre-processing.html#runvarbin-modules"><i class="fa fa-check"></i><b>4.2</b> runVarbin() modules</a></li>
<li class="chapter" data-level="4.3" data-path="pre-processing.html"><a href="pre-processing.html#from-external-count-data-or-user-defined-scaffolds"><i class="fa fa-check"></i><b>4.3</b> From external count data or user-defined scaffolds</a></li>
</ul></li>
<li class="chapter" data-level="5" data-path="qc-module.html"><a href="qc-module.html"><i class="fa fa-check"></i><b>5</b> QC module</a>
<ul>
<li class="chapter" data-level="5.1" data-path="qc-module.html"><a href="qc-module.html#runmetrics"><i class="fa fa-check"></i><b>5.1</b> runMetrics()</a></li>
<li class="chapter" data-level="5.2" data-path="qc-module.html"><a href="qc-module.html#findaneuploidcells"><i class="fa fa-check"></i><b>5.2</b> findAneuploidCells()</a></li>
<li class="chapter" data-level="5.3" data-path="qc-module.html"><a href="qc-module.html#findoutliers"><i class="fa fa-check"></i><b>5.3</b> findOutliers()</a></li>
</ul></li>
<li class="chapter" data-level="6" data-path="knn-smoothing.html"><a href="knn-smoothing.html"><i class="fa fa-check"></i><b>6</b> kNN smoothing</a></li>
<li class="chapter" data-level="7" data-path="analysis-and-visualization-module.html"><a href="analysis-and-visualization-module.html"><i class="fa fa-check"></i><b>7</b> Analysis and Visualization module</a>
<ul>
<li class="chapter" data-level="7.1" data-path="analysis-and-visualization-module.html"><a href="analysis-and-visualization-module.html#plotmetrics"><i class="fa fa-check"></i><b>7.1</b> plotMetrics()</a></li>
<li class="chapter" data-level="7.2" data-path="analysis-and-visualization-module.html"><a href="analysis-and-visualization-module.html#plotratio"><i class="fa fa-check"></i><b>7.2</b> plotRatio()</a></li>
<li class="chapter" data-level="7.3" data-path="analysis-and-visualization-module.html"><a href="analysis-and-visualization-module.html#runumap"><i class="fa fa-check"></i><b>7.3</b> runUmap()</a></li>
<li class="chapter" data-level="7.4" data-path="analysis-and-visualization-module.html"><a href="analysis-and-visualization-module.html#clustering"><i class="fa fa-check"></i><b>7.4</b> Clustering</a>
<ul>
<li class="chapter" data-level="7.4.1" data-path="analysis-and-visualization-module.html"><a href="analysis-and-visualization-module.html#findsugestedk"><i class="fa fa-check"></i><b>7.4.1</b> findSugestedK()</a></li>
<li class="chapter" data-level="7.4.2" data-path="analysis-and-visualization-module.html"><a href="analysis-and-visualization-module.html#findclusters"><i class="fa fa-check"></i><b>7.4.2</b> findClusters()</a></li>
<li class="chapter" data-level="7.4.3" data-path="analysis-and-visualization-module.html"><a href="analysis-and-visualization-module.html#plotumap"><i class="fa fa-check"></i><b>7.4.3</b> plotUmap()</a></li>
</ul></li>
<li class="chapter" data-level="7.5" data-path="analysis-and-visualization-module.html"><a href="analysis-and-visualization-module.html#scquantum-calcinteger"><i class="fa fa-check"></i><b>7.5</b> scquantum &amp; calcInteger()</a></li>
<li class="chapter" data-level="7.6" data-path="analysis-and-visualization-module.html"><a href="analysis-and-visualization-module.html#plotheatmap"><i class="fa fa-check"></i><b>7.6</b> plotHeatmap()</a></li>
<li class="chapter" data-level="7.7" data-path="analysis-and-visualization-module.html"><a href="analysis-and-visualization-module.html#runphylo-plotphylo"><i class="fa fa-check"></i><b>7.7</b> runPhylo() &amp; plotPhylo()</a></li>
<li class="chapter" data-level="7.8" data-path="analysis-and-visualization-module.html"><a href="analysis-and-visualization-module.html#plotfreq"><i class="fa fa-check"></i><b>7.8</b> plotFreq()</a></li>
<li class="chapter" data-level="7.9" data-path="analysis-and-visualization-module.html"><a href="analysis-and-visualization-module.html#calcconsensus"><i class="fa fa-check"></i><b>7.9</b> calcConsensus()</a></li>
<li class="chapter" data-level="7.10" data-path="analysis-and-visualization-module.html"><a href="analysis-and-visualization-module.html#plotconsensusline"><i class="fa fa-check"></i><b>7.10</b> plotConsensusLine()</a></li>
<li class="chapter" data-level="7.11" data-path="analysis-and-visualization-module.html"><a href="analysis-and-visualization-module.html#plotgenecopy"><i class="fa fa-check"></i><b>7.11</b> plotGeneCopy()</a></li>
<li class="chapter" data-level="7.12" data-path="analysis-and-visualization-module.html"><a href="analysis-and-visualization-module.html#plotalluvial"><i class="fa fa-check"></i><b>7.12</b> plotAlluvial()</a></li>
<li class="chapter" data-level="7.13" data-path="analysis-and-visualization-module.html"><a href="analysis-and-visualization-module.html#runpca"><i class="fa fa-check"></i><b>7.13</b> runPca()</a>
<ul>
<li class="chapter" data-level="7.13.1" data-path="analysis-and-visualization-module.html"><a href="analysis-and-visualization-module.html#plotscree"><i class="fa fa-check"></i><b>7.13.1</b> plotScree</a></li>
<li class="chapter" data-level="7.13.2" data-path="analysis-and-visualization-module.html"><a href="analysis-and-visualization-module.html#plotpca"><i class="fa fa-check"></i><b>7.13.2</b> plotPCA</a></li>
</ul></li>
</ul></li>
<li class="chapter" data-level="8" data-path="merging-copykit-objects.html"><a href="merging-copykit-objects.html"><i class="fa fa-check"></i><b>8</b> Merging CopyKit Objects</a></li>
<li class="chapter" data-level="9" data-path="session-info.html"><a href="session-info.html"><i class="fa fa-check"></i><b>9</b> Session Info</a></li>
<li class="chapter" data-level="10" data-path="faq.html"><a href="faq.html"><i class="fa fa-check"></i><b>10</b> FAQ</a>
<ul>
<li class="chapter" data-level="10.1" data-path="faq.html"><a href="faq.html#error-unable-to-load-package-after-installation."><i class="fa fa-check"></i><b>10.1</b> Error unable to load package after installation.</a></li>
<li class="chapter" data-level="10.2" data-path="faq.html"><a href="faq.html#copykit-is-very-slow-despite-parallel-processing"><i class="fa fa-check"></i><b>10.2</b> CopyKit is very slow despite parallel processing</a></li>
</ul></li>
<li class="chapter" data-level="11" data-path="learn-more.html"><a href="learn-more.html"><i class="fa fa-check"></i><b>11</b> Learn more</a>
<ul>
<li class="chapter" data-level="11.1" data-path="learn-more.html"><a href="learn-more.html#copy-number-data-from-short-reads-sequencing"><i class="fa fa-check"></i><b>11.1</b> Copy Number data from short reads sequencing</a></li>
<li class="chapter" data-level="11.2" data-path="learn-more.html"><a href="learn-more.html#principle-lm"><i class="fa fa-check"></i><b>11.2</b> Principle</a></li>
<li class="chapter" data-level="11.3" data-path="learn-more.html"><a href="learn-more.html#varbin-lm"><i class="fa fa-check"></i><b>11.3</b> VarBin</a></li>
<li class="chapter" data-level="11.4" data-path="learn-more.html"><a href="learn-more.html#gccor-lm"><i class="fa fa-check"></i><b>11.4</b> GC correction</a></li>
<li class="chapter" data-level="11.5" data-path="learn-more.html"><a href="learn-more.html#mergelevels-lm"><i class="fa fa-check"></i><b>11.5</b> Merge Levels</a></li>
<li class="chapter" data-level="11.6" data-path="learn-more.html"><a href="learn-more.html#infercn-lm"><i class="fa fa-check"></i><b>11.6</b> How do we infer copy numbers</a></li>
<li class="chapter" data-level="11.7" data-path="learn-more.html"><a href="learn-more.html#segmentation-lm"><i class="fa fa-check"></i><b>11.7</b> Segmentation</a>
<ul>
<li class="chapter" data-level="11.7.1" data-path="learn-more.html"><a href="learn-more.html#cbs-lm"><i class="fa fa-check"></i><b>11.7.1</b> CBS</a></li>
</ul></li>
</ul></li>
<li class="divider"></li>
<li><a href="https://github.com/rstudio/bookdown" target="blank">Published with bookdown</a></li>

</ul>

      </nav>
    </div>

    <div class="book-body">
      <div class="body-inner">
        <div class="book-header" role="navigation">
          <h1>
            <i class="fa fa-circle-o-notch fa-spin"></i><a href="./">CopyKit User Guide</a>
          </h1>
        </div>

        <div class="page-wrapper" tabindex="-1" role="main">
          <div class="page-inner">

            <section class="normal" id="section-">
<div id="analysis-and-visualization-module" class="section level1 hasAnchor" number="7">
<h1><span class="header-section-number">7</span> Analysis and Visualization module<a href="analysis-and-visualization-module.html#analysis-and-visualization-module" class="anchor-section" aria-label="Anchor link to header"></a></h1>
<p>The analysis and visualization module from CopyKit work in synergy to help you analyze your single cell copy number results.</p>
<div id="plotmetrics" class="section level2 hasAnchor" number="7.1">
<h2><span class="header-section-number">7.1</span> plotMetrics()<a href="analysis-and-visualization-module.html#plotmetrics" class="anchor-section" aria-label="Anchor link to header"></a></h2>
<p>The <code>plotMetrics()</code> function can plot any information store in <code>colData()</code>, which is passedto the <code>metric</code> argument. If a <code>label</code> argument is supplied, the points will be colored based on that information.</p>
<div class="sourceCode" id="cb66"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb66-1"><a href="analysis-and-visualization-module.html#cb66-1" aria-hidden="true" tabindex="-1"></a><span class="fu">plotMetrics</span>(tumor, <span class="at">metric =</span> <span class="fu">c</span>(<span class="st">&quot;overdispersion&quot;</span>, </span>
<span id="cb66-2"><a href="analysis-and-visualization-module.html#cb66-2" aria-hidden="true" tabindex="-1"></a>                              <span class="st">&quot;breakpoint_count&quot;</span>,</span>
<span id="cb66-3"><a href="analysis-and-visualization-module.html#cb66-3" aria-hidden="true" tabindex="-1"></a>                              <span class="st">&quot;reads_total&quot;</span>,</span>
<span id="cb66-4"><a href="analysis-and-visualization-module.html#cb66-4" aria-hidden="true" tabindex="-1"></a>                              <span class="st">&quot;reads_duplicates&quot;</span>,</span>
<span id="cb66-5"><a href="analysis-and-visualization-module.html#cb66-5" aria-hidden="true" tabindex="-1"></a>                              <span class="st">&quot;reads_assigned_bins&quot;</span>,</span>
<span id="cb66-6"><a href="analysis-and-visualization-module.html#cb66-6" aria-hidden="true" tabindex="-1"></a>                              <span class="st">&quot;percentage_duplicates&quot;</span>),</span>
<span id="cb66-7"><a href="analysis-and-visualization-module.html#cb66-7" aria-hidden="true" tabindex="-1"></a>            <span class="at">label =</span> <span class="st">&quot;percentage_duplicates&quot;</span>)</span></code></pre></div>
<pre><code>## Coloring by: percentage_duplicates</code></pre>
<p><img src="CopyKit-UserGuide_files/figure-html/unnamed-chunk-7-1.png" width="672" /></p>
</div>
<div id="plotratio" class="section level2 hasAnchor" number="7.2">
<h2><span class="header-section-number">7.2</span> plotRatio()<a href="analysis-and-visualization-module.html#plotratio" class="anchor-section" aria-label="Anchor link to header"></a></h2>
<p>Visualizing the seegmeentation to eensure it follows the ratios as expected is crucial to a copy number analysis.
This helps to verify the accuracy of the segmentation an assess the quality of the data visually.</p>
<p>The <code>plotRatio()</code> function is a useful tool for this, offering two different modes. When the input is the CopyKit object, an interactive app will open, allowing you to choose which cell to visualize from the drop-down option menu.</p>
<div class="sourceCode" id="cb68"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb68-1"><a href="analysis-and-visualization-module.html#cb68-1" aria-hidden="true" tabindex="-1"></a><span class="fu">plotRatio</span>(tumor)</span></code></pre></div>
<center>
<div class="figure">
<img src="images/plot_ratio_shiny.png" alt="" />
<p class="caption">Ratio Plot App</p>
</div>
</center>
<p>Providing a sample name to the <code>plotRatio()</code> function with the argument <code>sample_name</code>, will display the plot only for the selected cell.</p>
<div class="sourceCode" id="cb69"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb69-1"><a href="analysis-and-visualization-module.html#cb69-1" aria-hidden="true" tabindex="-1"></a><span class="fu">plotRatio</span>(tumor, <span class="st">&quot;PMTC6LiverC117AL4L5S1_S885_L003_R1_001&quot;</span>)</span></code></pre></div>
<p><img src="CopyKit-UserGuide_files/figure-html/plot_ratio_sample-1.png" width="672" /></p>
</div>
<div id="runumap" class="section level2 hasAnchor" number="7.3">
<h2><span class="header-section-number">7.3</span> runUmap()<a href="analysis-and-visualization-module.html#runumap" class="anchor-section" aria-label="Anchor link to header"></a></h2>
<p>The <code>runUmap()</code> function generates a <a href="https://umap-learn.readthedocs.io/en/latest/">UMAP</a> embedding, which is stored in the <code>reducedDim</code> slot.</p>
<p><code>runUmap()</code> is an important pre-processing step for the <code>findClusters()</code> feature.</p>
<div class="sourceCode" id="cb70"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb70-1"><a href="analysis-and-visualization-module.html#cb70-1" aria-hidden="true" tabindex="-1"></a>tumor <span class="ot">&lt;-</span> <span class="fu">runUmap</span>(tumor)</span></code></pre></div>
<pre><code>## Using assay: logr</code></pre>
<pre><code>## Embedding data with UMAP. Using seed 17</code></pre>
<pre><code>## Access reduced dimensions slot with: reducedDim(scCNA, &#39;umap&#39;).</code></pre>
<pre><code>## Done.</code></pre>
<p>You can pass additional arguments to control UMAP parameters using the <code>'...'</code> argument. The full list of additional arguments that can be passed on to <code>uwot::umap</code> with the ‘…’ argument can be found in the <a href="https://cran.r-project.org/web/packages/uwot/uwot.pdf">uwot manual</a> and information on their influence on clustering can be seen in the <a href="https://umap-learn.readthedocs.io/en/latest/clustering.html">UMAP webpage</a></p>
</div>
<div id="clustering" class="section level2 hasAnchor" number="7.4">
<h2><span class="header-section-number">7.4</span> Clustering<a href="analysis-and-visualization-module.html#clustering" class="anchor-section" aria-label="Anchor link to header"></a></h2>
<p>The <code>findClusters()</code> function performs clustering using the UMAP embedding generated by <code>runUmap()</code>. For detecting subclones, CopyKit uses
different clustering algorithms such as:</p>
<ol style="list-style-type: decimal">
<li><p><a href="https://hdbscan.readthedocs.io/en/latest/how_hdbscan_works.html">hdbscan</a> (recommended)</p></li>
<li><p><a href="https://www.nature.com/articles/s41598-019-41695-z">Leiden</a></p></li>
<li><p><a href="https://arxiv.org/abs/0803.0476">Louvain</a></p></li>
</ol>
<p>The hdbscan method is recommended and has been previously successfully applied in the work from Laks <em>et al.</em> and Minussi <em>et al.</em>.</p>
<div id="findsugestedk" class="section level3 hasAnchor" number="7.4.1">
<h3><span class="header-section-number">7.4.1</span> findSugestedK()<a href="analysis-and-visualization-module.html#findsugestedk" class="anchor-section" aria-label="Anchor link to header"></a></h3>
<p>The <code>findSuggestedK()</code> is a helper function that provides guidance to choose the <code>k</code> parameter for clustering algorithms. The function
<code>findSuggestedK</code> bootstraps clustering over a range of k values, and returns the value that maximizes the jaccard similarity, with <em>median</em> as the default metric (argument <code>metric</code>).</p>
<p>While <code>findSuggestedK</code> does not guarantee optimal clustering. It provides a guide to select k values.</p>
<div class="sourceCode" id="cb75"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb75-1"><a href="analysis-and-visualization-module.html#cb75-1" aria-hidden="true" tabindex="-1"></a>tumor <span class="ot">&lt;-</span> <span class="fu">findSuggestedK</span>(tumor)</span></code></pre></div>
<pre><code>## Calculating jaccard similarity for k range: 10 11 12 13 14 15 16 17 18 19 20 21 22 23 24 25 26 27 28</code></pre>
<pre><code>## </code></pre>
<pre><code>## Suggested k = 23 with median jaccard similarity of: 1</code></pre>
<p>The <code>plotSuggestedK()</code> function can be used to inspect the results of <code>findSuggestedK()</code>. It can plot a boxplot, heatmap (tile), or scatterplot</p>
<div class="sourceCode" id="cb79"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb79-1"><a href="analysis-and-visualization-module.html#cb79-1" aria-hidden="true" tabindex="-1"></a><span class="fu">plotSuggestedK</span>(tumor)</span></code></pre></div>
<p><img src="CopyKit-UserGuide_files/figure-html/plot_suggested_k_boxplot-1.png" width="672" /></p>
<p>If the argument <code>geom</code> is set to <em>tile</em>, <code>plotSuggestedK()</code> plots a heatmap where each row is a detected subclone, each column is a k assessed during the grid search and the color represents the jaccard similarity for a given clone.</p>
<p>The suggested value can be accessed from the metadata:</p>
<div class="sourceCode" id="cb80"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb80-1"><a href="analysis-and-visualization-module.html#cb80-1" aria-hidden="true" tabindex="-1"></a>S4Vectors<span class="sc">::</span><span class="fu">metadata</span>(tumor)<span class="sc">$</span>suggestedK</span></code></pre></div>
<pre><code>## [1] 23</code></pre>
</div>
<div id="findclusters" class="section level3 hasAnchor" number="7.4.2">
<h3><span class="header-section-number">7.4.2</span> findClusters()<a href="analysis-and-visualization-module.html#findclusters" class="anchor-section" aria-label="Anchor link to header"></a></h3>
<p>To run <code>findClusters()</code>, pass the CopyKit object as its input. If <code>findSuggestedK()</code> was run beforehand, <code>findClusters()</code> will automatically use the stored value from <code>findSuggestedK()</code> as the argument for k_subclones, unless otherwise specified.</p>
<div class="sourceCode" id="cb82"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb82-1"><a href="analysis-and-visualization-module.html#cb82-1" aria-hidden="true" tabindex="-1"></a>tumor <span class="ot">&lt;-</span> <span class="fu">findClusters</span>(tumor)</span></code></pre></div>
<pre><code>## Using suggested k_subclones = 23</code></pre>
<pre><code>## Finding clusters, using method: hdbscan</code></pre>
<pre><code>## Found 4 subclones.</code></pre>
<pre><code>## Done.</code></pre>
<p>If hdbscan is used for clustering, singletons <a href="https://hdbscan.readthedocs.io/en/latest/how_hdbscan_works.html">outliers</a> may be idetified and added to subgroup <code>c0</code>. Copykit will notify you of any cells classified as c0 after running findClusters(). To remove outliers, subset the CopyKit object with:</p>
<div class="sourceCode" id="cb87"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb87-1"><a href="analysis-and-visualization-module.html#cb87-1" aria-hidden="true" tabindex="-1"></a>tumor <span class="ot">&lt;-</span> tumor[,<span class="fu">colData</span>(tumor)<span class="sc">$</span>subclones <span class="sc">!=</span> <span class="st">&#39;c0&#39;</span>]</span></code></pre></div>
</div>
<div id="plotumap" class="section level3 hasAnchor" number="7.4.3">
<h3><span class="header-section-number">7.4.3</span> plotUmap()<a href="analysis-and-visualization-module.html#plotumap" class="anchor-section" aria-label="Anchor link to header"></a></h3>
<p>The <code>plotUmap()</code> function can be used to visualize the reduced dimensional embedding. Points can be colored by any element of the <code>colData</code> with the argument ‘label’.</p>
<div class="sourceCode" id="cb88"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb88-1"><a href="analysis-and-visualization-module.html#cb88-1" aria-hidden="true" tabindex="-1"></a><span class="fu">plotUmap</span>(tumor)</span></code></pre></div>
<pre><code>## Plotting Umap.</code></pre>
<p><img src="CopyKit-UserGuide_files/figure-html/unnamed-chunk-8-1.png" width="672" /></p>
<div class="sourceCode" id="cb90"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb90-1"><a href="analysis-and-visualization-module.html#cb90-1" aria-hidden="true" tabindex="-1"></a><span class="fu">plotUmap</span>(tumor, <span class="at">label =</span> <span class="st">&#39;subclones&#39;</span>)</span></code></pre></div>
<pre><code>## Plotting Umap.</code></pre>
<pre><code>## Coloring by: subclones.</code></pre>
<p><img src="CopyKit-UserGuide_files/figure-html/plot_umap_subclones-1.png" width="672" /></p>
</div>
</div>
<div id="scquantum-calcinteger" class="section level2 hasAnchor" number="7.5">
<h2><span class="header-section-number">7.5</span> scquantum &amp; calcInteger()<a href="analysis-and-visualization-module.html#scquantum-calcinteger" class="anchor-section" aria-label="Anchor link to header"></a></h2>
<p>The scquantum package is integrated into CopyKit to infer absolute copy numbers. It can be used either within CopyKit or as a <a href="https://github.com/navinlabcode/scquantum">standalone package</a> available on GitHub. Other methods for inferring absolute copy numbers are metadata and fixed. After running calcInteger(), CopyKit scales the segment ratios to integer values, which are stored in the integer slot and can be accessed using the assay() function.</p>
<p>To infer absolute ploidy values using scquantum, specify <code>scquantum</code> as the method argument in <code>calcInteger()</code>. The estimated computational ploidy is stored in <code>colData()</code> along with confidence_ratio, which compares the obtained score with the theoretical estimate, and ploidy_score, a transformation of confidence_ratio with values closer to 0 indicating better ploidy inference calls.</p>
<div class="sourceCode" id="cb93"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb93-1"><a href="analysis-and-visualization-module.html#cb93-1" aria-hidden="true" tabindex="-1"></a>tumor <span class="ot">&lt;-</span> <span class="fu">calcInteger</span>(tumor, <span class="at">method =</span> <span class="st">&#39;scquantum&#39;</span>, <span class="at">assay =</span> <span class="st">&#39;smoothed_bincounts&#39;</span>)</span></code></pre></div>
<p>The resulting <code>ploidy_score</code> scores can be used for further quality control of the single cell dataset.</p>
<div class="sourceCode" id="cb94"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb94-1"><a href="analysis-and-visualization-module.html#cb94-1" aria-hidden="true" tabindex="-1"></a>tumor <span class="ot">&lt;-</span> tumor[,<span class="fu">colData</span>(tumor)<span class="sc">$</span>ploidy_score <span class="sc">&lt;</span> <span class="fl">0.2</span>]</span></code></pre></div>
<p>Setting the method argument to ‘fixed’ scales all cells to a fixed value of ploidy (generally determined by flow cytometry), which is passed to CopyKit using the ploidy_value argument:</p>
<div class="sourceCode" id="cb95"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb95-1"><a href="analysis-and-visualization-module.html#cb95-1" aria-hidden="true" tabindex="-1"></a>tumor <span class="ot">&lt;-</span> <span class="fu">calcInteger</span>(tumor, <span class="at">method =</span> <span class="st">&#39;fixed&#39;</span>, <span class="at">ploidy_value =</span> <span class="fl">4.3</span>)</span></code></pre></div>
<p>If the integer assay exists, plotRatio() will plot it as a secondary axis.</p>
<div class="sourceCode" id="cb96"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb96-1"><a href="analysis-and-visualization-module.html#cb96-1" aria-hidden="true" tabindex="-1"></a><span class="fu">plotRatio</span>(tumor, <span class="st">&quot;PMTC6LiverC117AL4L5S1_S885_L003_R1_001&quot;</span>)</span></code></pre></div>
<p><img src="CopyKit-UserGuide_files/figure-html/plot_ratio_integer-1.png" width="672" /></p>
</div>
<div id="plotheatmap" class="section level2 hasAnchor" number="7.6">
<h2><span class="header-section-number">7.6</span> plotHeatmap()<a href="analysis-and-visualization-module.html#plotheatmap" class="anchor-section" aria-label="Anchor link to header"></a></h2>
<p>Copy number profiles can be visualized with a heatmap using the plotHeatmap() function. The elements of <code>colData()</code> can be annotated on the heatmap with the argument <code>label</code>. To order subclones, a consensus phylogeny can be calculated with <code>calcConsensus()</code> and <code>runConsensusPhylo()</code>, if the argument <code>order_cells</code> is not provided, the order of the cells in the heatmap will follow the order of the cells within the CopyKit object. In the plotHeatmap() function, gene annotations can be added with the genes argument.</p>
<p>To visualize copy number profiles with a heatmap we can use <code>plotHeatmap()</code>.</p>
<p>The heatmap can be annotated with elements of colData.</p>
<p>To order subclones, one option is to calculate a consensus phylogeny, explained in later sections:</p>
<div class="sourceCode" id="cb97"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb97-1"><a href="analysis-and-visualization-module.html#cb97-1" aria-hidden="true" tabindex="-1"></a>tumor <span class="ot">&lt;-</span> <span class="fu">calcConsensus</span>(tumor)</span>
<span id="cb97-2"><a href="analysis-and-visualization-module.html#cb97-2" aria-hidden="true" tabindex="-1"></a>tumor <span class="ot">&lt;-</span> <span class="fu">runConsensusPhylo</span>(tumor)</span>
<span id="cb97-3"><a href="analysis-and-visualization-module.html#cb97-3" aria-hidden="true" tabindex="-1"></a><span class="fu">plotHeatmap</span>(</span>
<span id="cb97-4"><a href="analysis-and-visualization-module.html#cb97-4" aria-hidden="true" tabindex="-1"></a>  tumor,</span>
<span id="cb97-5"><a href="analysis-and-visualization-module.html#cb97-5" aria-hidden="true" tabindex="-1"></a>  <span class="at">label =</span> <span class="st">&#39;subclones&#39;</span>,</span>
<span id="cb97-6"><a href="analysis-and-visualization-module.html#cb97-6" aria-hidden="true" tabindex="-1"></a>  <span class="at">genes =</span> <span class="fu">c</span>(<span class="st">&quot;TP53&quot;</span>, <span class="st">&quot;BRAF&quot;</span>, <span class="st">&quot;MYC&quot;</span>),</span>
<span id="cb97-7"><a href="analysis-and-visualization-module.html#cb97-7" aria-hidden="true" tabindex="-1"></a>  <span class="at">order_cells =</span> <span class="st">&#39;consensus_tree&#39;</span></span>
<span id="cb97-8"><a href="analysis-and-visualization-module.html#cb97-8" aria-hidden="true" tabindex="-1"></a>)</span></code></pre></div>
<pre><code>## Ordering cells by:consensus_tree</code></pre>
<pre><code>## Plotting Heatmap.</code></pre>
<p><img src="CopyKit-UserGuide_files/figure-html/plot_heatmap_sub-1.png" width="672" /></p>
<p>Integer copy number heatmaps can be plotted by passing assay = ‘integer’, with the integer matrix in the ‘integer’ slot. New information can be added to colData() and used in plotting functions. For example, spatial information encoded in the sample name can be extracted and added as a column to the metadata, and used to annotate the heatmap.</p>
<div class="sourceCode" id="cb100"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb100-1"><a href="analysis-and-visualization-module.html#cb100-1" aria-hidden="true" tabindex="-1"></a><span class="co"># adding spatial information</span></span>
<span id="cb100-2"><a href="analysis-and-visualization-module.html#cb100-2" aria-hidden="true" tabindex="-1"></a><span class="fu">colData</span>(tumor)<span class="sc">$</span>spatial_info <span class="ot">&lt;-</span> stringr<span class="sc">::</span><span class="fu">str_extract</span>(<span class="fu">colData</span>(tumor)<span class="sc">$</span>sample, <span class="st">&quot;L[0-9]&quot;</span>)</span>
<span id="cb100-3"><a href="analysis-and-visualization-module.html#cb100-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb100-4"><a href="analysis-and-visualization-module.html#cb100-4" aria-hidden="true" tabindex="-1"></a><span class="co"># plotting the integer heatmap with the spatial and subclonal information</span></span>
<span id="cb100-5"><a href="analysis-and-visualization-module.html#cb100-5" aria-hidden="true" tabindex="-1"></a><span class="fu">plotHeatmap</span>(tumor, <span class="at">assay =</span> <span class="st">&#39;integer&#39;</span>, <span class="at">label =</span> <span class="fu">c</span>(<span class="st">&quot;spatial_info&quot;</span>, <span class="st">&quot;subclones&quot;</span>), <span class="at">order_cells =</span> <span class="st">&#39;consensus_tree&#39;</span>)</span></code></pre></div>
<pre><code>## Ordering cells by:consensus_tree</code></pre>
<pre><code>## Plotting Heatmap.</code></pre>
<p><img src="CopyKit-UserGuide_files/figure-html/plot_ht_int-1.png" width="672" /></p>
<p>The spatial information can now also be used to color the elements of the UMAP:</p>
<div class="sourceCode" id="cb103"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb103-1"><a href="analysis-and-visualization-module.html#cb103-1" aria-hidden="true" tabindex="-1"></a><span class="fu">plotUmap</span>(tumor, <span class="at">label =</span> <span class="st">&#39;spatial_info&#39;</span>)</span></code></pre></div>
<pre><code>## Plotting Umap.</code></pre>
<pre><code>## Coloring by: spatial_info.</code></pre>
<p><img src="CopyKit-UserGuide_files/figure-html/umap_spatial-1.png" width="672" /></p>
</div>
<div id="runphylo-plotphylo" class="section level2 hasAnchor" number="7.7">
<h2><span class="header-section-number">7.7</span> runPhylo() &amp; plotPhylo()<a href="analysis-and-visualization-module.html#runphylo-plotphylo" class="anchor-section" aria-label="Anchor link to header"></a></h2>
<p>The <code>runPhylo()</code> function can be used to perform phylogenetic analysis of cells’ copy number profiles. The available methods are <a href="https://pubmed.ncbi.nlm.nih.gov/3447015/">Neighbor Joining</a> and <a href="https://pubmed.ncbi.nlm.nih.gov/8412650/">Balanced Minimum evolution</a>.The resulting tree is stored in the phylo slot within the CopyKit object.</p>
<p>The <code>plotPhylo()</code> function can be used to visualize the trees generated by <code>runPhylo()</code>. The leaves of the tree can be colored based on any element of the colData by using the argument <code>label</code>.</p>
<div class="sourceCode" id="cb106"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb106-1"><a href="analysis-and-visualization-module.html#cb106-1" aria-hidden="true" tabindex="-1"></a>tumor <span class="ot">&lt;-</span> <span class="fu">runPhylo</span>(tumor, <span class="at">metric =</span> <span class="st">&#39;manhattan&#39;</span>)</span></code></pre></div>
<pre><code>## Using ratio data...</code></pre>
<pre><code>## Calculating distance matrix</code></pre>
<pre><code>## Creating neighbor-joining tree.</code></pre>
<pre><code>## Access slot with copykit::phylo(scCNA).</code></pre>
<pre><code>## Done.</code></pre>
<div class="sourceCode" id="cb112"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb112-1"><a href="analysis-and-visualization-module.html#cb112-1" aria-hidden="true" tabindex="-1"></a><span class="fu">plotPhylo</span>(tumor, <span class="at">label =</span> <span class="st">&#39;subclones&#39;</span>)</span></code></pre></div>
<pre><code>## Warning: The tree contained negative edge lengths. If you want to ignore the edges, you can set
## &#39;options(ignore.negative.edge=TRUE)&#39;, then re-run ggtree.</code></pre>
<p><img src="CopyKit-UserGuide_files/figure-html/run_phylo-1.png" width="672" /></p>
</div>
<div id="plotfreq" class="section level2 hasAnchor" number="7.8">
<h2><span class="header-section-number">7.8</span> plotFreq()<a href="analysis-and-visualization-module.html#plotfreq" class="anchor-section" aria-label="Anchor link to header"></a></h2>
<p>The <code>plotFreq()</code> function can be used to visualize genomic gains or losses across the genome. This function calculates the frequency of gain or losses in each region of the genome based on a threshold applied to all samples. The <code>low_threshold</code> argument (below which values are counted as genomic losses) and <code>high_threshold</code> argument (above which values are counted as genomic gains) control the thresholds. It is recommended to set the thresholds based on the ploidy of the sample. To use the integer assay instead of the default segment_ratios assay, pass the <code>assay</code> argument. The visual representation of the frequencies can be shown as either an <code>area</code> or a <code>line</code> geom</p>
<div class="sourceCode" id="cb114"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb114-1"><a href="analysis-and-visualization-module.html#cb114-1" aria-hidden="true" tabindex="-1"></a><span class="fu">plotFreq</span>(tumor)</span></code></pre></div>
<p><img src="CopyKit-UserGuide_files/figure-html/plot_freq_sample-1.png" width="672" /></p>
<p>Elements of <code>colData()</code> can be used to split the plot across different groups.</p>
<div class="sourceCode" id="cb115"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb115-1"><a href="analysis-and-visualization-module.html#cb115-1" aria-hidden="true" tabindex="-1"></a><span class="fu">plotFreq</span>(tumor,</span>
<span id="cb115-2"><a href="analysis-and-visualization-module.html#cb115-2" aria-hidden="true" tabindex="-1"></a>         <span class="at">group =</span> <span class="st">&#39;subclones&#39;</span>)</span></code></pre></div>
<p><img src="CopyKit-UserGuide_files/figure-html/plot_freq_label-1.png" width="672" /></p>
</div>
<div id="calcconsensus" class="section level2 hasAnchor" number="7.9">
<h2><span class="header-section-number">7.9</span> calcConsensus()<a href="analysis-and-visualization-module.html#calcconsensus" class="anchor-section" aria-label="Anchor link to header"></a></h2>
<p>Consensus sequences can help visualize the different segments across subclones. To calculate consensus matrices we can use <code>calcConsensus()</code>.</p>
<div class="sourceCode" id="cb116"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb116-1"><a href="analysis-and-visualization-module.html#cb116-1" aria-hidden="true" tabindex="-1"></a>tumor <span class="ot">&lt;-</span> <span class="fu">calcConsensus</span>(tumor)</span></code></pre></div>
<p><code>plotHeatmap()</code> can plot a consensus heatmap:</p>
<div class="sourceCode" id="cb117"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb117-1"><a href="analysis-and-visualization-module.html#cb117-1" aria-hidden="true" tabindex="-1"></a><span class="fu">plotHeatmap</span>(tumor, <span class="at">consensus =</span> <span class="cn">TRUE</span>, <span class="at">label =</span> <span class="st">&#39;subclones&#39;</span>)</span></code></pre></div>
<pre><code>## order_cells argument is NULL. Samples are ordered according to
##               colnames(CopyKit)</code></pre>
<pre><code>## Plotting Heatmap.</code></pre>
<p><img src="CopyKit-UserGuide_files/figure-html/plot_heat_consensus-1.png" width="672" /></p>
<p><code>plotHeatmap()</code> can annotate the consensus heatmap with information from the metadata as long as label is the same as the information used to build the consensus matrix:</p>
<div class="sourceCode" id="cb120"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb120-1"><a href="analysis-and-visualization-module.html#cb120-1" aria-hidden="true" tabindex="-1"></a><span class="fu">plotHeatmap</span>(tumor, <span class="at">consensus =</span> <span class="cn">TRUE</span>, <span class="at">label =</span> <span class="st">&#39;subclones&#39;</span>, <span class="at">group =</span> <span class="st">&#39;spatial_info&#39;</span>)</span></code></pre></div>
<pre><code>## order_cells argument is NULL. Samples are ordered according to
##               colnames(CopyKit)</code></pre>
<pre><code>## Plotting Heatmap.</code></pre>
<p><img src="CopyKit-UserGuide_files/figure-html/plot_heat_freq_bar-1.png" width="672" /></p>
<p>By default <code>calcConsensus()</code> uses the subclones information to calculate a consensus for each subclone.
Any element of the <code>colData()</code> can be used to calculate the consensus.</p>
<p><strong>Note:</strong> Consensus matrices can be calculated from the integer assay. Importantly, the integer matrix must be in the <code>assay(tumor, 'integer')</code> slot. Check <code>calcInteger()</code> for more info.</p>
<div class="sourceCode" id="cb123"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb123-1"><a href="analysis-and-visualization-module.html#cb123-1" aria-hidden="true" tabindex="-1"></a>tumor <span class="ot">&lt;-</span> <span class="fu">calcConsensus</span>(tumor, <span class="at">consensus_by =</span> <span class="st">&#39;subclones&#39;</span>, <span class="at">assay =</span> <span class="st">&#39;integer&#39;</span>)</span></code></pre></div>
</div>
<div id="plotconsensusline" class="section level2 hasAnchor" number="7.10">
<h2><span class="header-section-number">7.10</span> plotConsensusLine()<a href="analysis-and-visualization-module.html#plotconsensusline" class="anchor-section" aria-label="Anchor link to header"></a></h2>
<p>To compare the differences among subclones, <code>plotConsensusLine()</code> opens an interactive app where the consensus sequences are plotted as lines.</p>
<div class="sourceCode" id="cb124"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb124-1"><a href="analysis-and-visualization-module.html#cb124-1" aria-hidden="true" tabindex="-1"></a><span class="fu">plotConsensusLine</span>(tumor)</span></code></pre></div>
<center>
<div class="figure">
<img src="images/plot_consensus_shiny.png" alt="" />
<p class="caption">Plot Consensus Line</p>
</div>
</center>
</div>
<div id="plotgenecopy" class="section level2 hasAnchor" number="7.11">
<h2><span class="header-section-number">7.11</span> plotGeneCopy()<a href="analysis-and-visualization-module.html#plotgenecopy" class="anchor-section" aria-label="Anchor link to header"></a></h2>
<p>To check copy number states across of genes we can use <code>plotGeneCopy()</code>. Two different geoms: “swarm” (default) or “violin” can be applied.</p>
<p>As with other plotting functions, points can be colored with the argument ‘label’.</p>
<div class="sourceCode" id="cb125"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb125-1"><a href="analysis-and-visualization-module.html#cb125-1" aria-hidden="true" tabindex="-1"></a><span class="fu">plotGeneCopy</span>(tumor, <span class="at">genes =</span> <span class="fu">c</span>(<span class="st">&quot;CDKN2A&quot;</span>,</span>
<span id="cb125-2"><a href="analysis-and-visualization-module.html#cb125-2" aria-hidden="true" tabindex="-1"></a>                              <span class="st">&quot;FGFR1&quot;</span>,</span>
<span id="cb125-3"><a href="analysis-and-visualization-module.html#cb125-3" aria-hidden="true" tabindex="-1"></a>                              <span class="st">&quot;TP53&quot;</span>,</span>
<span id="cb125-4"><a href="analysis-and-visualization-module.html#cb125-4" aria-hidden="true" tabindex="-1"></a>                              <span class="st">&quot;PTEN&quot;</span>,</span>
<span id="cb125-5"><a href="analysis-and-visualization-module.html#cb125-5" aria-hidden="true" tabindex="-1"></a>                              <span class="st">&quot;MYC&quot;</span>,</span>
<span id="cb125-6"><a href="analysis-and-visualization-module.html#cb125-6" aria-hidden="true" tabindex="-1"></a>                              <span class="st">&quot;CDKN1A&quot;</span>,</span>
<span id="cb125-7"><a href="analysis-and-visualization-module.html#cb125-7" aria-hidden="true" tabindex="-1"></a>                              <span class="st">&quot;MDM2&quot;</span>,</span>
<span id="cb125-8"><a href="analysis-and-visualization-module.html#cb125-8" aria-hidden="true" tabindex="-1"></a>                              <span class="st">&quot;AURKA&quot;</span>,</span>
<span id="cb125-9"><a href="analysis-and-visualization-module.html#cb125-9" aria-hidden="true" tabindex="-1"></a>                              <span class="st">&quot;PIK3CA&quot;</span>,</span>
<span id="cb125-10"><a href="analysis-and-visualization-module.html#cb125-10" aria-hidden="true" tabindex="-1"></a>                              <span class="st">&quot;CCND1&quot;</span>,</span>
<span id="cb125-11"><a href="analysis-and-visualization-module.html#cb125-11" aria-hidden="true" tabindex="-1"></a>                              <span class="st">&quot;KRAS&quot;</span>),</span>
<span id="cb125-12"><a href="analysis-and-visualization-module.html#cb125-12" aria-hidden="true" tabindex="-1"></a>                      <span class="at">label =</span> <span class="st">&#39;spatial_info&#39;</span>)</span></code></pre></div>
<pre><code>## Coloring by: spatial_info</code></pre>
<p><img src="CopyKit-UserGuide_files/figure-html/unnamed-chunk-11-1.png" width="672" /></p>
<p>A positional dodge can be added to facilitate the visualization across groups:</p>
<div class="sourceCode" id="cb127"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb127-1"><a href="analysis-and-visualization-module.html#cb127-1" aria-hidden="true" tabindex="-1"></a><span class="fu">plotGeneCopy</span>(tumor, </span>
<span id="cb127-2"><a href="analysis-and-visualization-module.html#cb127-2" aria-hidden="true" tabindex="-1"></a>             <span class="at">genes =</span> <span class="fu">c</span>(<span class="st">&quot;CDKN2A&quot;</span>,</span>
<span id="cb127-3"><a href="analysis-and-visualization-module.html#cb127-3" aria-hidden="true" tabindex="-1"></a>                              <span class="st">&quot;FGFR1&quot;</span>,</span>
<span id="cb127-4"><a href="analysis-and-visualization-module.html#cb127-4" aria-hidden="true" tabindex="-1"></a>                              <span class="st">&quot;TP53&quot;</span>,</span>
<span id="cb127-5"><a href="analysis-and-visualization-module.html#cb127-5" aria-hidden="true" tabindex="-1"></a>                              <span class="st">&quot;PTEN&quot;</span>,</span>
<span id="cb127-6"><a href="analysis-and-visualization-module.html#cb127-6" aria-hidden="true" tabindex="-1"></a>                              <span class="st">&quot;MYC&quot;</span>,</span>
<span id="cb127-7"><a href="analysis-and-visualization-module.html#cb127-7" aria-hidden="true" tabindex="-1"></a>                              <span class="st">&quot;CDKN1A&quot;</span>,</span>
<span id="cb127-8"><a href="analysis-and-visualization-module.html#cb127-8" aria-hidden="true" tabindex="-1"></a>                              <span class="st">&quot;MDM2&quot;</span>,</span>
<span id="cb127-9"><a href="analysis-and-visualization-module.html#cb127-9" aria-hidden="true" tabindex="-1"></a>                              <span class="st">&quot;AURKA&quot;</span>,</span>
<span id="cb127-10"><a href="analysis-and-visualization-module.html#cb127-10" aria-hidden="true" tabindex="-1"></a>                              <span class="st">&quot;PIK3CA&quot;</span>,</span>
<span id="cb127-11"><a href="analysis-and-visualization-module.html#cb127-11" aria-hidden="true" tabindex="-1"></a>                              <span class="st">&quot;CCND1&quot;</span>,</span>
<span id="cb127-12"><a href="analysis-and-visualization-module.html#cb127-12" aria-hidden="true" tabindex="-1"></a>                              <span class="st">&quot;KRAS&quot;</span>),</span>
<span id="cb127-13"><a href="analysis-and-visualization-module.html#cb127-13" aria-hidden="true" tabindex="-1"></a>             <span class="at">label =</span> <span class="st">&#39;subclones&#39;</span>,</span>
<span id="cb127-14"><a href="analysis-and-visualization-module.html#cb127-14" aria-hidden="true" tabindex="-1"></a>             <span class="at">dodge.width =</span> <span class="fl">0.8</span>)</span></code></pre></div>
<pre><code>## Coloring by: subclones</code></pre>
<p><img src="CopyKit-UserGuide_files/figure-html/unnamed-chunk-12-1.png" width="672" /></p>
<p>A barplot geom is also provided to visualize the integer data as a frequency barplot for each gene:</p>
<div class="sourceCode" id="cb129"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb129-1"><a href="analysis-and-visualization-module.html#cb129-1" aria-hidden="true" tabindex="-1"></a><span class="fu">plotGeneCopy</span>(tumor, <span class="at">genes =</span> <span class="fu">c</span>(<span class="st">&quot;CDKN2A&quot;</span>,</span>
<span id="cb129-2"><a href="analysis-and-visualization-module.html#cb129-2" aria-hidden="true" tabindex="-1"></a>                              <span class="st">&quot;FGFR1&quot;</span>,</span>
<span id="cb129-3"><a href="analysis-and-visualization-module.html#cb129-3" aria-hidden="true" tabindex="-1"></a>                              <span class="st">&quot;TP53&quot;</span>,</span>
<span id="cb129-4"><a href="analysis-and-visualization-module.html#cb129-4" aria-hidden="true" tabindex="-1"></a>                              <span class="st">&quot;PTEN&quot;</span>,</span>
<span id="cb129-5"><a href="analysis-and-visualization-module.html#cb129-5" aria-hidden="true" tabindex="-1"></a>                              <span class="st">&quot;MYC&quot;</span>,</span>
<span id="cb129-6"><a href="analysis-and-visualization-module.html#cb129-6" aria-hidden="true" tabindex="-1"></a>                              <span class="st">&quot;CDKN1A&quot;</span>,</span>
<span id="cb129-7"><a href="analysis-and-visualization-module.html#cb129-7" aria-hidden="true" tabindex="-1"></a>                              <span class="st">&quot;MDM2&quot;</span>,</span>
<span id="cb129-8"><a href="analysis-and-visualization-module.html#cb129-8" aria-hidden="true" tabindex="-1"></a>                              <span class="st">&quot;AURKA&quot;</span>,</span>
<span id="cb129-9"><a href="analysis-and-visualization-module.html#cb129-9" aria-hidden="true" tabindex="-1"></a>                              <span class="st">&quot;PIK3CA&quot;</span>,</span>
<span id="cb129-10"><a href="analysis-and-visualization-module.html#cb129-10" aria-hidden="true" tabindex="-1"></a>                              <span class="st">&quot;CCND1&quot;</span>,</span>
<span id="cb129-11"><a href="analysis-and-visualization-module.html#cb129-11" aria-hidden="true" tabindex="-1"></a>                              <span class="st">&quot;KRAS&quot;</span>),</span>
<span id="cb129-12"><a href="analysis-and-visualization-module.html#cb129-12" aria-hidden="true" tabindex="-1"></a>             <span class="at">geom =</span> <span class="st">&#39;barplot&#39;</span>,</span>
<span id="cb129-13"><a href="analysis-and-visualization-module.html#cb129-13" aria-hidden="true" tabindex="-1"></a>             <span class="at">assay =</span> <span class="st">&#39;integer&#39;</span>)</span></code></pre></div>
<p><img src="CopyKit-UserGuide_files/figure-html/plot_gene_copy_integer-1.png" width="672" /></p>
</div>
<div id="plotalluvial" class="section level2 hasAnchor" number="7.12">
<h2><span class="header-section-number">7.12</span> plotAlluvial()<a href="analysis-and-visualization-module.html#plotalluvial" class="anchor-section" aria-label="Anchor link to header"></a></h2>
<p>To visualize frequencies across elements of the metadata we can use <code>plotAlluvial()</code></p>
<div class="sourceCode" id="cb130"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb130-1"><a href="analysis-and-visualization-module.html#cb130-1" aria-hidden="true" tabindex="-1"></a><span class="fu">plotAlluvial</span>(tumor, <span class="at">label =</span> <span class="fu">c</span>(<span class="st">&quot;subclones&quot;</span>, <span class="st">&quot;spatial_info&quot;</span>))</span></code></pre></div>
<p><img src="CopyKit-UserGuide_files/figure-html/plot_alluvial-1.png" width="672" /></p>
</div>
<div id="runpca" class="section level2 hasAnchor" number="7.13">
<h2><span class="header-section-number">7.13</span> runPca()<a href="analysis-and-visualization-module.html#runpca" class="anchor-section" aria-label="Anchor link to header"></a></h2>
<p>Principal Component Analysis can be run with <code>runPca()</code></p>
<div class="sourceCode" id="cb131"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb131-1"><a href="analysis-and-visualization-module.html#cb131-1" aria-hidden="true" tabindex="-1"></a>tumor <span class="ot">&lt;-</span> <span class="fu">runPca</span>(tumor)</span></code></pre></div>
<pre><code>## Using assay: logr</code></pre>
<pre><code>## Embedding data with PCA.</code></pre>
<pre><code>## Access reduced dimensions slot with: SingleCellExperiment::reducedDim(scCNA, &#39;pca&#39;).</code></pre>
<pre><code>## Done.</code></pre>
<p>The results are stored in the <code>reducedDim(tumor, 'PCA')</code> slot.</p>
<p>Principal Components can be used as an alternative pre-processing step to the <code>findClusters()</code> function by changing <code>findClusters()</code> <em>embedding</em> argument to ‘PCA’. The number of principal components to be used for clustering can also be set within `findClusters() with the argument ncomponents. At this time better results are achieved by using the default UMAP embedding and it is the recommend pre-processing step. However PCA remains as a viable alternative</p>
<div id="plotscree" class="section level3 hasAnchor" number="7.13.1">
<h3><span class="header-section-number">7.13.1</span> plotScree<a href="analysis-and-visualization-module.html#plotscree" class="anchor-section" aria-label="Anchor link to header"></a></h3>
<p>To determine the number of useful principal components a scree plot can be shown with:</p>
<div class="sourceCode" id="cb136"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb136-1"><a href="analysis-and-visualization-module.html#cb136-1" aria-hidden="true" tabindex="-1"></a><span class="fu">plotScree</span>(tumor)</span></code></pre></div>
<p><img src="CopyKit-UserGuide_files/figure-html/plot_scree-1.png" width="672" /></p>
</div>
<div id="plotpca" class="section level3 hasAnchor" number="7.13.2">
<h3><span class="header-section-number">7.13.2</span> plotPCA<a href="analysis-and-visualization-module.html#plotpca" class="anchor-section" aria-label="Anchor link to header"></a></h3>
<p>To visualize the first 2 principal components you can use <code>plotPca()</code>.</p>
<div class="sourceCode" id="cb137"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb137-1"><a href="analysis-and-visualization-module.html#cb137-1" aria-hidden="true" tabindex="-1"></a><span class="fu">plotPca</span>(tumor, <span class="at">label =</span> <span class="st">&#39;spatial_info&#39;</span>)</span></code></pre></div>
<pre><code>## Plotting PCA.</code></pre>
<pre><code>## Coloring by: spatial_info.</code></pre>
<p><img src="CopyKit-UserGuide_files/figure-html/unnamed-chunk-13-1.png" width="672" /></p>

</div>
</div>
</div>
            </section>

          </div>
        </div>
      </div>
<a href="knn-smoothing.html" class="navigation navigation-prev " aria-label="Previous page"><i class="fa fa-angle-left"></i></a>
<a href="merging-copykit-objects.html" class="navigation navigation-next " aria-label="Next page"><i class="fa fa-angle-right"></i></a>
    </div>
  </div>
<script src="libs/gitbook-2.6.7/js/app.min.js"></script>
<script src="libs/gitbook-2.6.7/js/clipboard.min.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-search.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-sharing.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-fontsettings.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-bookdown.js"></script>
<script src="libs/gitbook-2.6.7/js/jquery.highlight.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-clipboard.js"></script>
<script>
gitbook.require(["gitbook"], function(gitbook) {
gitbook.start({
"sharing": {
"github": false,
"facebook": true,
"twitter": true,
"linkedin": false,
"weibo": false,
"instapaper": false,
"vk": false,
"whatsapp": false,
"all": ["facebook", "twitter", "linkedin", "weibo", "instapaper"]
},
"fontsettings": {
"theme": "white",
"family": "sans",
"size": 2
},
"edit": {
"link": null,
"text": null
},
"history": {
"link": null,
"text": null
},
"view": {
"link": null,
"text": null
},
"download": ["CopyKit-UserGuide.pdf", "CopyKit-UserGuide.epub"],
"search": {
"engine": "fuse",
"options": null
},
"toc": {
"collapse": "subsection"
}
});
});
</script>

</body>

</html>
